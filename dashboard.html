<!DOCTYPE html>
<html>
<head>
  <title>Seat Booking</title>
  <style>
    .seat {
      width: 50px;
      height: 50px;
      margin: 5px;
      display: inline-block;
      background: lightgreen;
      text-align: center;
      line-height: 50px;
      cursor: pointer;
    }
    .booked {
      background: red;
      color: white;
    }
  </style>
</head>
<body>

<h2>Seat Booking Portal</h2>

<select id="slotSelect">
  <option value="s1">6-10 AM (399)</option>
  <option value="s2">10-2 PM (399)</option>
  <option value="s3">2-6 PM (399)</option>
  <option value="s4">6-10 PM (399)</option>
  <option value="s1s2">6AM-2PM (799)</option>
  <option value="s3s4">2PM-10PM (799)</option>
  <option value="all">6AM-10PM (1199)</option>
</select>

<div id="seats"></div>

<script type="module">
import { db } from "./firebase.js";
import { doc, getDoc, setDoc } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const seatsDiv = document.getElementById("seats");
const slotSelect = document.getElementById("slotSelect");

function generateSeats() {
  for (let i = 1; i <= 142; i++) {
    const seat = document.createElement("div");
    seat.classList.add("seat");
    seat.innerText = i;

    seat.onclick = () => bookSeat(i);

    seatsDiv.appendChild(seat);
  }
}

async function bookSeat(seatId) {
  const slot = slotSelect.value;
  const seatRef = doc(db, "seats", "seat_" + seatId);
  const snap = await getDoc(seatRef);

  let data = snap.exists() ? snap.data() : 
  { s1:false, s2:false, s3:false, s4:false };

  let slotsToBook = [];

  if (slot === "s1") slotsToBook = ["s1"];
  if (slot === "s2") slotsToBook = ["s2"];
  if (slot === "s3") slotsToBook = ["s3"];
  if (slot === "s4") slotsToBook = ["s4"];
  if (slot === "s1s2") slotsToBook = ["s1","s2"];
  if (slot === "s3s4") slotsToBook = ["s3","s4"];
  if (slot === "all") slotsToBook = ["s1","s2","s3","s4"];

  for (let s of slotsToBook) {
    if (data[s]) {
      alert("Slot already booked");
      return;
    }
  }

  for (let s of slotsToBook) {
    data[s] = true;
  }

  await setDoc(seatRef, data);
  alert("Seat booked successfully");
}

generateSeats();
</script>
</body>
</html>